\name{MPCMR_GMM}
\alias{MPCMR_GMM}
%- Also NEED an '\alias' for EACH other topic documented here.
\title{
Individual-level time-varying MR fitting
}
\description{
Multiple-principal-component Mendelian randomization fitting with GMM methods. This function supports overlapping-data setting, where the overlapping data will first clumped to one-sample and continues the fitting afterward.
}
\usage{
MPCMR_GMM( Gmatrix,
           res,
           Yvector,
           Gymatrix=NA,
           IDmatch=NA,
           nPC=NA,
           nL=NA,
           LMCI=TRUE,
           LMCI2=TRUE,
           nLM=20,
           Parallel=TRUE,
           XYmodel=NA
                      )
}
%- maybe also 'usage' for other objects documented here.
\arguments{
  \item{Gmatrix}{
a matrix indicates the instrument information
}
\item{res}{
a list result contains the principal component matrix and the eigenfunctions. \code{res} is usually derived by \code{FPCA}.
}
\item{Yvector}{
a vector indicates the individual point outcome
}
\item{Gymatrix}{
a matrix indicates the instrument information for the outcome data. The default value is \code{NA}, which corresponds to the one-sample setting.
}
\item{IDmatch}{
a vector indicates the overlapping data index. This is better generated by \code{match()}. The default value is \code{NA}, correponding to the one-sample setting
}
\item{nPC}{
a integer indicates the number of principal components used for MPCMR fitting. The default value is the number of principal compoments that just explain more than 95 percent variations.
}
\item{nL}{
a integer indicates the degree of the polynomial (the number of polynomial basisfunctions)
}
\item{LMCI}{
logic. Whether to calculate the CI with LM statistic where the basisfunction is the eigenfunction.
}
\item{LMCI2}{
logic. Whether to calculate the CI with LM statistic where the basisfunction is the polynomial.
}
\item{nLM}{
a integer indicates the number of increasing point for each dimension when calculating the CI with LM statistic.
}
\item{Parallel}{
logic. Whether to use parallel computing. The default value is \code{TRUE} and the cores used are the maximal cores munus one.
}
\item{XYmodel}{
a character indicates the XY model. It should be only used for simulation purpose.
}

}
\details{
%%  ~~ If necessary, more details than the description above ~~
}
\value{
\code{MPCMR_GMM} retuns a list, consisting of the fitted parameters (and their standard errors), the weak IV assessment results, the IV validity assessment results, the fitted curve.
}
\references{
%% ~put references to the literature/web site here ~
}
\author{
%%  ~~who you are~~
}
\note{
%%  ~~further notes~~
}

%% ~Make other sections like Warning with \section{Warning }{....} ~

\seealso{
%% ~~objects to See Also as \code{\link{help}}, ~~~
}
\examples{
set.seed(seed)
RES<-getX(N=N_used,J=30,ZXmodel=ZXmodel_used)
res <- FPCA(RES$Ly_sim, RES$Lt_sim,list(dataType='Sparse', error=TRUE, verbose=TRUE))

DAT<-getY(RES, XYmodel=XYmodel_used)
MPCMRres<-MPCMR_GMM(  Gmatrix=RES$DAT[,1:RES$details$J],
                       res=res,
                       Yvector=DAT$Y,
                       Gymatrix=NA,
                       IDmatch=NA,
                       nPC=NA,
                       nL=NA,
                       LMCI=TRUE,
                       nLM=20,
                       Parallel=TRUE,
                       XYmodel= XYmodel_used
                     )

}
% Add one or more standard keywords, see file 'KEYWORDS' in the
% R documentation directory (show via RShowDoc("KEYWORDS")):
% \keyword{ ~kwd1 }
% \keyword{ ~kwd2 }
% Use only one keyword per line.
% For non-standard keywords, use \concept instead of \keyword:
% \concept{ ~cpt1 }
% \concept{ ~cpt2 }
% Use only one concept per line.
